---
title: "Running STRUCTURE"
author: "Eric Archer"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{5. Running STRUCTURE}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---
The _strataG_ package provides an interface to running the program STRUCTURE (Pritchard et al. 2000) as well as some diagnostic measures, the program CLUMPP (Jakobsson and Rosenberg 2007), and plotting. The first step is to make sure that the STRUCTURE and executables are properly installed in the path such that they can be run from any location on a command line. For Windows operating systems, the location of the executables should be specified in the PATH environmental variable. For Macs and UNIX platforms, the executables or links to them can be placed in a folder like /usr/local/bin.

The _structureRun_ function takes a _gtypes_ object and a vector of potential cluster numbers (_k.range_) to examine. By default, it runs one replicate per value of _k_, however this can be changed by modifying the _num.k.rep_ argument. Also notable is that the default executable name is _structure_. If the executable is named something different on your system, this should be changed through the _exec_ argument.

A simple example run is as follows:
```{r}
# load msat data and create gtypes
library(strataG.devel)
data(dolph.strata)
data(dolph.msats)
msats.merge <- merge(dolph.strata, dolph.msats, all.y = TRUE, description = date())
msats <- df2gtypes(msats.merge, ploidy = 2, id.col = 1, strata.col = 3, loc.col = 5)
rownames(dolph.strata) <- dolph.strata$ids
schemes(msats) <- dolph.strata[, c("fine", "broad")]
msats <- stratify(msats, "fine")

# run 10 replicates of STRUCTURE for k = 2
msat.struct <- structureRun(msats, k.range = 2, num.k.rep = 10)
```

The result of _structureRun_ is a list for each replicate. Each element in that list is a list with the following elements:
```{r}
names(msat.struct[[1]])
```

The _summary_ element has the following summary values about the replicate run:
```{r}
msat.struct[[1]]$summary
```

The _q.mat_ element contains the q-matrix of cluster assignment probabilities:
```{r}
head(msat.struct[[1]]$q.mat)
```

Other commonly manipulated parameters for STRUCTURE can be set in _structureRun_, and are described in detail in the help page and the manual for STRUCTURE.

The Evanno summaries (Evanno et al 2005) can be generated with the _evanno_ function:
```{r}
msat.struct <- structureRun(msats, k.range = 1:5, num.k.rep = 5)
evanno(msat.struct)
```

The results of multiple replicates for a value of _k_ can be combined with _clumpp_, which returns a q-matrix data.frame:
```{r}
msat.clmp <- clumpp(msat.struct, k = 3)
head(msat.clmp)
```

These results can then be visualized with _structurePlot_:
```{r}
structurePlot(msat.clmp, horiz = F)
```